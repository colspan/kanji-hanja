
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Kanji/Hanja Pronunciations</title>
  <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link rel="stylesheet" href="css/d3.parsets.css" type="text/css" />
  <style>

  .ribbon-mouse path{
    cursor:pointer;
  }

  #kanji_list table{
    width: 100%;
    table-layout: fixed;
    cursor:pointer;
  }
  #kanji_list table tr:hover td{
    background:#ddddff;
  }
  #kanji_list_scroller {
    overflow: scroll;
    height: 200px;
  }

  #kanji_face {
    margin: 10px;
    font-size: 120px;
    width:150px;
    height:150px;
    border:1px solid;
    display:table-cell;
    text-align:center;
    vertical-align:middle;
  }
  .pronounce_display{
    height:90px;
    margin:0;
  }
  #kana, #hangul{
    font-size: 40px;
    margin:18px 0 0 0;
    height:30px;
    display:block;
  }

  #vis {
    position:relative;
  }
  #chart_tooltips_container {
    position:absolute;
    width:400px;
    height:18px;
    top:-12px;
    right:0px;
  }
  #chart_tooltips {
    font-size:12pt;
  }

  </style>
  <script src="http://code.jquery.com/jquery.js"></script>
  <script src="lib/bootstrap.min.js" charset="utf-8"></script>
  <script src="lib/d3.v3.min.js" charset="utf-8"></script>
  <script src="lib/d3.parsets.js"></script>
</head>
<body>
  <div class="container">
    <h1>Kanji/Hanja Pronunciations <small>Comparison between JP and KR</small></h1>

    <div class="row">
      <div class="span7">
        <ul id="dimension_changer" class="nav nav-tabs">
          <li class="active"><a href="#" id="initial">初声</a></li>
          <li><a href="#" id="medial">中声</a></li>
          <li><a href="#" id="final">終声</a></li>
          <li><a href="#" id="initial_medial">初声〜中声</a></li>
          <li><a href="#" id="medial_final">中声〜終声</a></li>
          <li><a href="#" id="initial_medial_final">初声〜中声〜終声</a></li>
        </ul>
      </div>

      <div class="span5">
        Facebook
      </div>
    </div>

    <div id="vis">
      <div id="chart_tooltips_container" class="well well-small">
        <span id="chart_tooltips"></span>
      </div>
    </div>

    <div class="row">
      <div class="span7" id="kanji_list">
        <table class="table table-condensed table-bordered">
          <thead>
            <tr><th>Kanji/Hanja(漢字) <span class="badge badge-info" id="kanji_hit_number">0</span></th><th>Japanese(日本語)</th><th>Korean(한국어)</th></tr>
          </thead>
        </table>
        <div id="kanji_list_scroller">
          <table class="table table-striped table-condensed table-hover">
            <tbody id="kanji_tbody">
            </tbody>
          </table>
        </div>
      </div>
      <div class="span2">
        <span class="label label-info">Kanji / Hanja</span>
        <div id="kanji_face"></div>
      </div>
      <div class="span3">
        <div class="pronounce_display"><span class="label">Japanese</span> <span id="kana"></span> <span id="kana_romaji"></span></div>
        <div class="pronounce_display"><span class="label">Korean</span> <span id="hangul"></span> <span id="hangul_romaja"></span></div>        </div>
      </div>




<script>
var chart = d3.parsets().height('300').width('940')
      .dimensions(
        [
          "かな(初声)",
          "한글(初声)"
        ]
      );
    chart.ribbonClicked(chartRibbonClicked);
    chart.tooltip(chartTooltip);

    var vis = d3.select("#vis").append("svg")
    .attr("width", chart.width())
    .attr("height", chart.height());

    d3.csv("csv/jp_kr_kanji_pronunciation_dic.csv", function(error, csv) {
      vis.datum(csv).call(chart);
    });

    $('#dimension_changer a').click(function(e){
      var dims;
      e.preventDefault();
      set_name = $(this).attr('id');
      switch(set_name){
        case 'initial':
          dims = ["かな(初声)","한글(初声)"];
          break;
          case 'medial':
            dims = ["かな(中声)","한글(中声)"];
            break;
          case 'final':
            dims = ["かな(終声)","한글(終声)"];
            break;
          case 'initial_medial':
            dims = ["かな(初声)","かな(中声)","한글(初声)","한글(中声)"];
            break;
          case 'medial_final':
            dims = ["かな(中声)","かな(終声)","한글(中声)","한글(終声)"];
            break;
          case 'initial_medial_final':
            dims = ["かな(初声)","かな(中声)","かな(終声)","한글(初声)","한글(中声)","한글(終声)"];
            break;
          }
        $('#dimension_changer li').removeClass('active');
        $(this).first().parent().addClass('active');
        if(dims){
          if( chart.dimensions().length != dims.length ){
            var data = vis.datum();
            $("#vis svg").remove();
            vis = d3.select("#vis").append("svg")
            .attr("width", chart.width())
            .attr("height", chart.height())
            .datum(data);
          }
          chart.dimensions(dims);
          vis.call(chart);
        }
      }
    );



function chartRibbonClicked(d,nodes){
  var searched_kanjis = vis.datum().filter(function(data){
    var i,ret=true;
    for(i=0;i<nodes.length;i++){
      ret = data[nodes[i].dimension]==nodes[i].name && ret;
    }
    return ret;
  });

  // 件数を表示
  $('#kanji_hit_number').text(searched_kanjis.length);

  // 漢字リスト作成
  var kanji_list_elem = d3.select('#kanji_tbody');
  var rows = kanji_list_elem.selectAll('tr').data(searched_kanjis);
  rows.enter().append('tr');
  var cells = rows.selectAll("td").data(function(d){return [ d["kanji"], d["kana"]+"("+d["kana_romaji"]+")", d["hangul"]+"("+d["hangul_romaja"]+")" ];});
  cells.enter().append("td");
  cells.exit().remove();
  cells.text(function(d){return d;});
  cells.on("mouseover",function(){
    var d = d3.select(this.parentNode).data()[0];
    $('#kanji_face').text(d['kanji']);
    $('#kana').text(d['kana']);
    $('#kana_romaji').text(d['kana_romaji']);
    $('#hangul').text(d['hangul']);
    $('#hangul_romaja').text(d['hangul_romaja']);
  });
  rows.exit().remove();
  $("#kanji_list_scroller").scrollTop(0);
}
function chartTooltip(d) {
  var count = d.count;
  var path = [];
  while (d.parent) {
    if (d.name) path.unshift(d.name.replace(/\([0-9]{2}\)/g, ""));
    d = d.parent;
  }
  $('#chart_tooltips').html(path.join(' <i class="icon-arrow-right"></i> ') + " " + d3.format(",f")(count) + " (" + d3.format("%")(count / d.count) + ")");
}




</script>

  <h2>説明</h2>

  <ol>
    <li>1563文字のべ1838通りの読みについて、日韓の対応関係を可視化</li>
    <ol>
      <li><a href="http://ja.wikipedia.org/wiki/Wikipedia:%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">Wikipediaダウンロード</a>より抽出した日韓の題名から同一表記(音読み)の記事を抽出。</li>
      <li>日本語の読み及び初/中/終声の分解にはChasen(Juman)およびKakasiの出力結果を利用</li>
      <li>韓国語体(旧字体)と日本語体の対応はTODOの対応表で解決</li>
      <li>機械的抽出に混じった訓読みは手作業で削除</li>
      <li>※常用漢字の網羅度は未集計</li>
    </ol>
  </ol>

  <h2>ライセンス</h2>

  <p>MIT Licenseとします。</p>

</div>

</body>
</html>
